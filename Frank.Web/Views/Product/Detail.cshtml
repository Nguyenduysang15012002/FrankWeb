@{
	ViewBag.Title = "Detail";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

@using Frank.Model.Entities
@using Frank.Web.Models.ProductModels
@model ProductDetailVM
<style>
	.a {
		margin: auto;
		height: auto;
		margin-top: 40px;
	}

	.b {
		margin: 30px auto;
	}

	.c {
		margin: auto;
		width: 100%;
		align-items: center;
		text-align: center;
		padding-top: 10px;
	}

	.product-main-image {
		width: 80%; /* Adjust the main image size */
		height: auto;
	}

	.product-thumb-image {
		width: 50px; /* Adjust the thumbnail image size */
		height: 50px;
	}
</style>
<style>
	.number-box {
		display: flex;
		align-items: center;
		justify-content: center;
		margin: 20px auto;
		width: 150px;
		height: 40px;
		border: 1px solid #ccc;
		border-radius: 4px;
		overflow: hidden;
	}

		.number-box input {
			width: 100px;
			height: 100%;
			border: none; /* Remove border */
			text-align: center;
			outline: none;
			background-color: transparent; /* Make background transparent */
			box-shadow: none; /* Remove box shadow */
			-webkit-appearance: none; /* Remove default styling in Safari */
			-moz-appearance: none; /* Remove default styling in Firefox */
			appearance: none; /* Remove default styling */
		}

		.number-box .next-icon {
			display: flex;
			align-items: center;
			justify-content: center;
			width: 30px;
			height: 100%;
			background-color: #f0f0f0;
			cursor: pointer;
			transition: background-color 0.3s; /* Add transition effect */
		}

			.number-box .next-icon:hover {
				background-color: #ddd; /* Change background color on hover */
			}

			.number-box .next-icon:disabled {
				background-color: #e0e0e0;
				cursor: not-allowed;
			}

	.custom-input {
		border: none; /* Bỏ border */
		border-right: none; /* Bỏ border bên phải */

		padding-right: 0; /* Bỏ padding bên phải */
		outline: none; /* Bỏ đường viền khi focus */
	}
</style>
<div class="a">
	<div class="b">
		<div class="container">
			<div class="row gx-5">
				<aside class="col-lg-6">
					<div class="border rounded-4 mb-3 d-flex justify-content-center">
						<img style="margin:30px auto;height:400px" class="rounded-4 fit product-main-image" src="@Model.Images.Url_Image" alt="Không có ảnh" />
					</div>
				</aside>
				<main class="col-lg-6">
					<div class="ps-lg-3">
						<h2 class="title text-dark">
							<br />
							Tên sản phẩm: @Model.Product.Name
						</h2>
						<div class="d-flex flex-row my-3">
							<div class="text-warning mb-1 me-2">
								<i class="fa fa-star"></i>
								<i class="fas fa-star-half-alt"></i>
							</div>
						</div>
						<p>
							Mô tả: @Model.Product.Description
						</p>
						<div class="row">
							<label class="col-sm-6">Giá:</label>
							<input class="col-sm-3 custom-input" type="text" value="@Model.AttributeProducts.Price" /><span class="col-sm-3" style="text-align:end;">VND/Chai</span>
						</div>
						<div class="row">
							<hr />
						</div>
						<div class="row">
							<label class="col-sm-6">Số lượng còn:</label>
							<input id="Soluongcon" class="col-sm-3 custom-input" type="text" value="@Model.Product.Quantity" /><span class="col-sm-3" style="text-align:end;">Chai</span>
						</div>
						<div class="row">
							<hr />
						</div>
						<div class="row">
							<label class="col-sm-6">Số lượng mua:</label>
							<input id="Soluong" class="col-sm-3 custom-input" type="number" value="1" /><span class="col-sm-3" style="text-align:end;">Chai</span>
						</div>

						<hr />
						<div class="row">
							<button id="submit" class="btn btn-primary shadow-0" style="width:100%;"> <i class="me-1 fa fa-shopping-basket"></i> Thêm vào giỏ hàng </button>
						</div>
					</div>
				</main>
			</div>
		</div>
	</div>
</div>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery-3.6.0.slim.min.js"></script>
<script src="~/Scripts/toastr.min.js"></script>
<link rel="stylesheet" href="~/Content/toastr.min.css" />
<script src="~/Scripts/jquery-3.6.0.min.js"></script>
<script>
	$(document).ready(function () {
		var $soluongcon = '@Model.Product.Quantity';
		var $soluongmua = '@ViewBag.checksoluong';
		$('#Soluong').on('input change', function () {
			var soluongcon = parseInt($('#Soluongcon').val());
			var soluong = parseInt($(this).val());

			if (soluong > soluongcon) {
				toastr.error('Số lượng không được lớn hơn số lượng còn ' + soluongcon, 'Thông báo');
				$(this).val(soluongcon);
			} else if (soluong <= 0) {
				toastr.error('Số lượng phải lớn hơn 0', 'Thông báo!');
				$(this).val(1);
			}
		});
    $('#submit').click(function (event) {
        event.preventDefault();
        var User_Id = '@ViewBag.Id';
        var Product_Id = '@Model.Product.Id';
        var Soluong = $("#Soluong").val();

        if (!User_Id) {
            toastr.error("Bạn cần đăng nhập để mua hàng.", "Thông báo");
        } else {
            // Đảm bảo dữ liệu được gửi dưới dạng object JSON
            var requestData = {
                User_Id: parseInt(User_Id),
                Product_Id: parseInt(Product_Id),
                Soluong: parseInt(Soluong)
            };

            AjaxCall('@Url.Action("Create", "Product")', 'POST', requestData, function (response) {
                if (response.success) {
					toastr.success(response.message, "Thông báo");
					 setTimeout(function() {
						 window.location.href = '@Url.Action("GioHang", "Home")' + '?Id=' + User_Id;				 
					 }, 1000);
                } else {
                    toastr.error(response.message, "Thông báo");
                }
			});
			debugger
        }
    });
});

function AjaxCall(url, type, data, successCallback, errorCallback) {
    $.ajax({
        url: url,
        type: type,
        data: data,
        success: successCallback,
        error: errorCallback || function () {
            toastr.error('Có lỗi xảy ra trong quá trình xử lý yêu cầu', 'Lỗi');
        }
    });
}

</script>



