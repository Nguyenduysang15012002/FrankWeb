@using Frank.Service.ShopCartService.Dto;
@using PagedList;
@using PagedList.Mvc;
@model  IPagedList<Frank.Service.ShopCartService.Dto.ShopCartDto>
@{
	ViewBag.Title = "GioHang";
	Layout = "~/Views/Shared/_Layout.cshtml";
	var Id = ViewBag.Id;
}
<link rel="stylesheet" href="~/Content/toastr.min.css" />
<script src="~/Scripts/jquery-3.6.0.min.js"></script>
<style>
	.product-main-image {
		max-width: 100px; /* Điều chỉnh kích thước ảnh */
		max-height: 100px;
	}

	/* Thêm các style cần thiết khác tại đây */
</style>
<style>
	.a {
		margin: auto;
		height: auto;
		margin-top: 60px;
	}



	.product-main-image {
		width: 80%; /* Adjust the main image size */
		height: auto;
	}

	.product-thumb-image {
		width: 50px; /* Adjust the thumbnail image size */
		height: 50px;
	}

	th {
		font-weight: bold;
		text-align: center;
	}

	td {
		text-align: center;
	}

	.no-uppercase {
		text-transform: none;
	}
	/* CSS cho phân trang */
	.datatable-bottom {
		text-align: center;
		margin: 20px 0;
	}

	.datatable-pagination {
		display: inline-block;
		padding: 0;
		margin: 0;
	}

		.datatable-pagination ul {
			list-style-type: none;
			padding: 0;
			margin: 0;
			display: flex;
			justify-content: center;
		}

			.datatable-pagination ul li {
				display: inline;
				margin: 0 5px;
			}

				.datatable-pagination ul li a {
					color: #007bff;
					text-decoration: none;
					padding: 8px 16px;
					border: 1px solid #ddd;
					border-radius: 4px;
					transition: background-color 0.3s, color 0.3s;
				}

					.datatable-pagination ul li a:hover {
						background-color: #007bff;
						color: white;
						border-color: #007bff;
					}

				.datatable-pagination ul li.active a {
					background-color: #007bff;
					color: white;
					border-color: #007bff;
				}

				.datatable-pagination ul li.disabled a {
					color: #ddd;
					pointer-events: none;
					border-color: #ddd;
				}
</style>
<div class="a">
	<div class="container">
		<div class="row mt-4">
			<div class="col-md-12">
				<div class="card">
					<div class="card-body">
						<h4 class="card-title">Danh sách sản phẩm trong giỏ hàng</h4>
						<div class="table-responsive">

							<table class="table table-bordered">
								<thead>
									<tr>
										<th>STT</th>
										<th>Hình ảnh</th>
										<th>Tên sản phẩm</th>
										<th>Giá</th>
										<th>Số lượng</th>
										<th>Tổng tiền</th>
										<th>Thao tác</th>
									</tr>
								</thead>
								<tbody>
									@if (Model != null && Model.Any())
									{
										var i = 1;

										foreach (var item in Model)
										{
											<tr>
												<td>@i</td>
												<td><img class="rounded-4 fit product-main-image" style="height:40px;width:70px" src="@item.Image_Product" alt="Không có ảnh" /></td>
												<td>@item.NameProduct</td>
												<td>@item.Price</td>
												<td>@item.Quantity</td>
												<td>@item.TotalPrice <i style="text-align:end;">VND</i></td>
												<td>
													<a class="btn btn-primary bg-white text-primary shadow-0 no-uppercase delete-shopcart" data-product-id="@item.Product_Id" data-user-id="@item.User_Id">
														<i class="bi bi-trash text-danger"></i>
													</a>
												</td>
											</tr>

											i++;
										}
										<tr>
											<td colspan="7" style="text-align: end;">
												<a id="Dathang" href='@Url.Action("Order", "Home")?User_Id=@Id' style="margin-right:25px;" class="btn btn-primary">Đặt hàng</a>
											</td>
										</tr>
									}
									else
									{
										<tr>
											<td colspan="7" style="color:red;font-weight:bold;text-align:center">Không có sản phẩm nào trong giỏ hàng.</td>
										</tr>
										<tr>
											<td colspan="7" style="color:red;font-weight:bold;text-align:center"></td>
										</tr>
										<tr>
											<td colspan="7" style="color:red;font-weight:bold;text-align:center"></td>
										</tr>
										<tr>
											<td colspan="7" style="color:red;font-weight:bold;text-align:center"></td>
										</tr>
									}

								</tbody>
							</table>
						</div>
						<hr />
						<div class="datatable-bottom">
							<nav class="datatable-pagination">
								@{
									var options = new PagedListRenderOptions
									{
										DisplayLinkToFirstPage = PagedListDisplayMode.IfNeeded,
										DisplayLinkToLastPage = PagedListDisplayMode.IfNeeded,
										DisplayLinkToPreviousPage = PagedListDisplayMode.IfNeeded,
										DisplayLinkToNextPage = PagedListDisplayMode.IfNeeded,
										DisplayLinkToIndividualPages = true
									};

									Func<int, string> pageUrlGenerator = page => Url.Action("GioHang", new { Id = ViewBag.Id, page, pageSize = ViewBag.PageSize });

									@Html.PagedListPager(Model, pageUrlGenerator, options)
								}
							</nav>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script src="~/Scripts/toastr.min.js"></script>
<script>
$(document).ready(function() {
	var Id = parseInt('@Id');

    $('.delete-shopcart').on('click', function(e) {
        e.preventDefault();
        var Product_Id = $(this).data('product-id');
        var User_Id = $(this).data('user-id');
        var requestData = {
            User_Id: parseInt(User_Id),
            Product_Id: parseInt(Product_Id)
		};
        AjaxCall('@Url.Action("DeleteShopcart", "Home")', 'POST', requestData, function(response) {
            if (response.success) {
				toastr.success(response.message, "Thông báo");
				 setTimeout(function() {
					 window.location.href = '@Url.Action("GioHang", "Home")' + '?Id=' + Id;
					 debugger
				   }, 1000);
            } else {
                toastr.error(response.message, "Thông báo");
            }
        });
    });
});
</script>
<script>
	function AjaxCall(url, type, data, successCallback, errorCallback) {
		$.ajax({
			url: url,
			type: type,
			data: data,
			success: successCallback,
			error: errorCallback || function () {
				toastr.error('Có lỗi xảy ra trong quá trình xử lý yêu cầu', 'Lỗi');
			}
		});
	}
</script>
